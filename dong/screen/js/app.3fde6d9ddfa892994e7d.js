webpackJsonp([1],{"+Bis":function(t,e){},"07SU":function(t,e){},"5amY":function(t,e){},"6A3X":function(t,e){},AMzZ:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={};a.d(s,"getCover",function(){return z}),a.d(s,"getLotteries",function(){return H}),a.d(s,"getImgBarrage",function(){return M}),a.d(s,"getVote",function(){return N}),a.d(s,"getBarrages",function(){return W}),a.d(s,"getSigns",function(){return X}),a.d(s,"getAvas",function(){return G}),a.d(s,"getLotteriesBackData",function(){return Q});var r=a("/5sW"),n=a("mvHQ"),i=a.n(n),o=a("Xxa5"),c=a.n(o),u=a("Gu7T"),g=a.n(u),d=a("exGp"),h=a.n(d),l=a("Dd8w"),v=a.n(l),m=(a("mtWM"),{data:function(){return{secretkey:"",ph:"请输入活动key"}},methods:{login:function(){var t=this;return h()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t.secretkey){e.next=2;break}return e.abrupt("return");case 2:$.get("/screen/login",{secretkey:t.secretkey},function(e){if(e.success)return sessionStorage.setItem("in","1"),void t.$emit("conn");t.secretkey="",t.ph=e.msg});case 3:case"end":return e.stop()}},e,t)}))()}},mounted:function(){this.$refs.input.focus()}}),f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{attrs:{id:"login"}},[a("div",{attrs:{id:"form"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.secretkey,expression:"secretkey"}],ref:"input",attrs:{type:"text",placeholder:t.ph},domProps:{value:t.secretkey},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.login(e):null},input:function(e){e.target.composing||(t.secretkey=e.target.value)}}}),t._v(" "),a("button",{attrs:{type:"button"},on:{click:t.login}},[t._v("进入")])])])},staticRenderFns:[]};var p=a("VU/8")(m,f,!1,function(t){a("+Bis")},"data-v-70a72f7c",null).exports,b=a("NYxO"),_={name:"App",components:{Login:p},data:function(){return{show:!1,bgStyle:{backgroundImage:'url("https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1523003055233&di=1b31a13de28456f71da2388476513c46&imgtype=0&src=http%3A%2F%2Fimg.tuku.cn%2Ffile_big%2F201502%2Ff4490c6cdb9b42cd9d6d856e502fa328.jpg")'},ws:null,wsURL:"ws://192.168.1.110/aws",shareImg:"",shareImgFlag:!1,userShareImg:"",userShareImgFlag:!1,signCache:[],barrageCache:[],getSignedUserTimestamp:0,lotteriesCache:{},shareImgStyle:{zIndex:3}}},methods:v()({},Object(b.c)({setCover:"setCover",setLotteries:"setLotteries",setImgBarrage:"setImgBarrage",setVote:"setVote",addBarrage:"addBarrage",addSign:"addSign",setAvas:"setAvas",setLotteriesBackData:"setLotteriesBackData"}),{conn:function(){this.show=!this.show,this.$router.replace("/barrage"),this.ws=new WebSocket(this.wsURL),console.log(this.ws);var t=this.ws;t.onopen=this.wsonopen,t.onmessage=this.wsonmessage},wsonopen:function(t){console.log("connected.")},wsonmessage:function(t){var e=JSON.parse(t.data);switch(e.type){case 2:this.cover(e);break;case 11:this.lottery(e);break;case 1:this.barrageImg(e);break;case 24:this.hideBarrageImg(e);break;case 14:this.votes(e);break;case 0:this.barrage(e);break;case 3:this.sign(e);break;case 23:this.userShareImgHandle(e);break;case 22:this.setAllUserHeadPic(e)}},setAllUserHeadPic:function(t){var e=this,a=[];t.data.forEach(function(t){a.push("/headpics/"+t.headpic)}),this.setAvas(a),this.setLotteries(this.lotteriesCache.data),this.setLotteriesBackData(this.lotteriesCache),"/lottery"===this.$route.fullPath&&(this.$router.push("/sign"),setTimeout(function(){e.$router.push("/lottery")},500)),this.$router.push("lottery")},getSignedUser:function(){var t=this;return h()(c.a.mark(function e(){var a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.getSignedUserTimestamp,$.get("/users/sign",{aid:t.aid,s:a},function(e){if(e.success){var a=e.data||[];a.forEach(function(t){t.headpic="/headpics/"+t.headpic}),t.signCache=[].concat(g()(t.signCache),g()(a)),t.getSignedUserTimestamp=e.msg}});case 2:case"end":return e.stop()}},e,t)}))()},userShareImgHandle:function(t){var e=this,a={name:t.sender.name,content:"分享了一张图片",headpic:"/headpics/"+t.sender.headpic};this.addBarrage(a),this.userShareImg="/display-pictures/"+t.data,this.$router.push("/barrage");var s=new Image;s.src="/display-pictures/"+t.data,console.log(s),s.onload=function(){s.width>s.height&&(e.shareImgStyle={zIndex:3,width:"90%"}),e.shareImgStyle={zIndex:3,height:"90%"},console.log(s),e.userShareImgFlag=!0,setTimeout(function(){e.userShareImgFlag=!1},5e3)}},sign:function(t){var e=this;this.aid=t.receiver,this.getSignedUser(),this.$router.push("/sign"),this.popUsers||(this.popUsers=setInterval(function(){0!==e.signCache.length&&e.addSign(e.signCache.pop())},500),setInterval(function(){e.getSignedUser()},1e4))},barrage:function(t){var e=this;if(/\{\/.+?\/\}/.test(t.data)){var a=t.data.match(/\{\/.+?\/\}/g);a.forEach(function(e,s){var r=a[s].match(/-?\d+px/g),n='<span class="face" style="background-position: '+r[0]+" "+r[1]+';"}></span>';t.data=t.data.replace(e,n)})}console.log(t.data),this.barrageCache.push({name:t.sender.name,content:t.data,headpic:"/headpics/"+t.sender.headpic}),console.log({name:t.sender.name,content:t.data,headpic:"/headpics/"+t.sender.headpic}),"/barrage"!==this.$route.fullPath&&this.$router.push("/barrage"),this.barrageTimer||(this.barrageTimer=setInterval(function(){0!==e.barrageCache.length&&e.addBarrage(e.barrageCache.shift())},1e3))},votes:function(t){this.setVote(t.data),"/vote"!==this.$route.fullPath&&this.$router.push("/vote")},hideBarrageImg:function(t){this.shareImgFlag=!1},barrageImg:function(t){this.shareImgFlag||(this.shareImg="/display-pictures/"+t.data,this.shareImgFlag=!0)},lottery:function(t){t.data.users.forEach(function(t){t.headpic="/headpics/"+t.headpic}),this.lotteriesCache=t,this.ws.send(i()({type:22,receiver:t.receiver}))},cover:function(t){this.setCover("/advertisings/"+t.data),this.$router.push("/cover")}}),mounted:function(){"1"===(sessionStorage.getItem("in")||"0")&&this.conn()}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{style:t.bgStyle,attrs:{id:"bg"}}),t._v(" "),a("div",{attrs:{id:"app"}},[a("transition",{attrs:{name:"bounceRight"}},[t.show?t._e():a("login",{on:{conn:t.conn}})],1),t._v(" "),a("transition",{attrs:{name:"bounceLeft"}},[t.show?a("router-view",{attrs:{ws:t.ws}}):t._e()],1),t._v(" "),a("transition",{attrs:{name:"bounceRight"}},[t.shareImgFlag?a("img",{staticStyle:{"z-index":"6"},attrs:{src:t.shareImg,id:"shareImg"}}):t._e()]),t._v(" "),a("transition",{attrs:{name:"bounceDown"}},[t.userShareImgFlag?a("img",{style:t.shareImgStyle,attrs:{src:t.userShareImg,id:"shareImg"}}):t._e()])],1)])},staticRenderFns:[]};var y=a("VU/8")(_,w,!1,function(t){a("fyA7")},null,null).exports,I=a("/ocq"),k={data:function(){return{signed:1}},mounted:function(){},watch:{getSigns:function(){setTimeout(function(){$("#signers").animate({scrollTop:$("#signers ul").height()},250)},1e3)}},computed:v()({},Object(b.b)(["getSigns"]))},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"sign"}},[a("div",{staticClass:"header"},[a("span",[t._v("已签到: "+t._s(t.getSigns.length)+"人")])]),t._v(" "),a("div",{staticClass:"signer",attrs:{id:"signers"}},[a("transition-group",{attrs:{name:"slideDown",tag:"ul"}},t._l(t.getSigns,function(e,s){return a("li",{key:s},[a("div",{staticClass:"icon"},[a("img",{attrs:{src:e.headpic,alt:""}})]),t._v(" "),a("div",{staticClass:"uname"},[t._v(t._s(e.name))])])}))],1)])},staticRenderFns:[]};var S=a("VU/8")(k,C,!1,function(t){a("xvQg")},"data-v-36368ef3",null).exports,B={props:["ws"],data:function(){return{}},mounted:function(){console.log(this.getBarrages),console.log(1)},watch:{getBarrages:function(){setTimeout(function(){$("#barrages-static").animate({scrollTop:$("#barrages-static ul").height()},300)},1e3)}},computed:v()({},Object(b.b)(["getBarrages"]))},U={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"barrage"}},[a("div",{attrs:{id:"barrages-static"}},[a("transition-group",{attrs:{name:"fadeLeft",tag:"ul"}},t._l(t.getBarrages,function(e,s){return a("li",{key:s},[a("div",{staticClass:"ava"},[a("img",{attrs:{src:e.headpic,alt:""}})]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"uname"},[t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),a("div",{staticClass:"data",domProps:{innerHTML:t._s(e.content)}})])])}))],1)])},staticRenderFns:[]};var x=a("VU/8")(B,U,!1,function(t){a("5amY")},"data-v-45db06a8",null).exports,L={data:function(){return{showCoverImg:!0}},computed:v()({},Object(b.b)(["getCover"]))},A={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{style:{backgroundImage:"url('"+this.getCover+"')"},attrs:{id:"cover"}},[e("transition",{attrs:{name:"fade"}},[this.showCoverImg?e("img",{attrs:{src:this.getCover,alt:""}}):this._e()])],1)},staticRenderFns:[]};var F=a("VU/8")(L,A,!1,function(t){a("scK/")},"data-v-021978cc",null).exports,T={methods:{randBarColor:function(){return["progress-bar-success","progress-bar-info","progress-bar-warning","progress-bar-danger"][parseInt(4*Math.random())]}},data:function(){return{}},computed:v()({},Object(b.b)(["getVote"])),mounted:function(){}},V={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"vote"}},[a("div",{staticClass:"vote-title"},[t._v("\n    投票: "+t._s(t.getVote.name)+"\n  ")]),t._v(" "),a("div",{attrs:{id:"vote-list"}},[a("ul",t._l(t.getVote.voteGroups,function(e,s){return a("li",{key:s},[a("div",{staticClass:"option"},[a("div",{staticClass:"title"},[t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),a("div",{staticClass:"number"},[t._v("\n            "+t._s(e.number)+" 票\n            \n          ")])]),t._v(" "),a("div",{staticClass:"rate"},[a("div",{staticClass:"progress"},[a("div",{staticClass:"progress-bar progress-bar-striped active",class:t.randBarColor(),style:{width:e.number/t.getVote.voteSum*100+"%"},attrs:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100"}})])])])}))])])},staticRenderFns:[]};var D=a("VU/8")(T,V,!1,function(t){a("07SU")},"data-v-6f7aec0c",null).exports,E={props:["ws"],data:function(){return{randomAva:"",randoming:!1,showUsers:[]}},methods:{startAni:function(){var t=this,e=50*this.getLotteries.users.length-1,a=0;e-=3;var s=this.getAvas;this.randoming=!0;var r=setInterval(function(){if(e%50==0&&(t.showUsers.push(t.getLotteries.users[a]),++a>=t.getLotteries.users.length))return clearInterval(r),t.randoming=!1,void t.ws.send(i()(t.getLotteriesBackData));t.randomAva=s[parseInt(Math.random()*s.length)],e--},100)}},mounted:function(){this.startAni(),setTimeout(function(){$(".list").animate({scrollTop:$(".list ul").height()},250)},1e3)},computed:v()({},Object(b.b)(["getLotteries","getAvas","getLotteriesBackData"]))},R={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"lottery"}},[a("div",{staticClass:"header"},[t._v("\n    抽奖 "),a("span",{staticStyle:{color:"#ff4343"}},[t._v(t._s(t.getLotteries.name)+" - "+t._s(t.getLotteries.prizename))])]),t._v(" "),a("div",{staticClass:"list"},[a("transition-group",{attrs:{name:"slideDown",tag:"ul"}},t._l(t.showUsers,function(e,s){return a("li",{key:s},[a("div",{staticClass:"icon"},[a("img",{attrs:{src:e.headpic,alt:""}})]),t._v(" "),a("div",{staticClass:"uname"},[t._v(t._s(e.name))])])}))],1),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.randoming?a("div",{staticClass:"lottery-ani"},[a("img",{attrs:{src:t.randomAva,alt:""}})]):t._e()])],1)},staticRenderFns:[]};var P=a("VU/8")(E,R,!1,function(t){a("vX83")},"data-v-1128d431",null).exports;r.a.use(I.a);var O=new I.a({routes:[{path:"/"},{path:"/sign",name:"sign",component:S},{path:"/barrage",name:"barrage",component:x},{path:"/cover",name:"cover",component:F},{path:"/vote",name:"vote",component:D},{path:"/lottery",name:"lottery",component:P}]}),j=a("mUbh"),z=function(t){return t.cover},H=function(t){return t.lotteries},M=function(t){return t.imgBarrage},N=function(t){return t.vote},W=function(t){return t.barrages},X=function(t){return t.signs},G=function(t){return t.avas},Q=function(t){return t.lotteriesBackData},Y={barrages:[],avas:[],cover:"",signs:[],vote:{},lotteries:[],imgBarrage:{},lotteriesBackData:{}},q={setCover:function(t,e){t.cover=e},setLotteries:function(t,e){t.lotteries=e},setImgBarrage:function(t,e){t.imgBarrage=e},setVote:function(t,e){t.vote=e},addBarrage:function(t,e){t.barrages.push(e)},addSign:function(t,e){t.signs.push(e)},setAvas:function(t,e){t.avas=e},setLotteriesBackData:function(t,e){t.lotteriesBackData=e}};a("sax8");r.a.use(b.a);var J=new b.a.Store({actions:j,getters:s,state:Y,mutations:q,strict:!1,plugins:[]});a("W2Pu"),a("6A3X"),a("AMzZ");r.a.config.productionTip=!1,new r.a({el:"#app",router:O,store:J,render:function(t){return t(y)}})},W2Pu:function(t,e){},fyA7:function(t,e){},mUbh:function(t,e){},"scK/":function(t,e){},vX83:function(t,e){},xvQg:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.3fde6d9ddfa892994e7d.js.map